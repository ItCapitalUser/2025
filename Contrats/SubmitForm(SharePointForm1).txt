//SubmitForm(SharePointForm1)
If(
    SharePointForm1.Mode = FormMode.New,
    Set(
        RecordInList,
        Defaults([@ContractsHR])
    ),
    If(
        SharePointForm1.Mode = FormMode.Edit,
        Set(
            RecordInList,
            SharePointIntegration.Selected
        )
    )
);
Set(
    nameGroupHr,
    ddl_businessGroups.Selected.GroupPermission
);
/*If(
    And(
        glbEditForm = true,
        Value(lb_idMainDoc.Text) <> 0
    ),
    Set(
        varIdMainDoc,
        cmb_numMainDoc.Selected.ID
    );
    Set(
        varNumMainDoc,
        cmb_numMainDoc.Selected.'Ім’я'
    ),
    Set(
        varIdMainDoc,
        0
    );
    Set(
        varNumMainDoc,
        "0"
    )
);*/
If(
    Value(lb_idMainDoc.Text) = 0,
    Set(
        varIdMainDoc,
        0
    );
    Set(
        varNumMainDoc,
        txt_NumDoc.Text
    ),
    Set(
        varIdMainDoc,
        ddl_numMainDoc.Selected.'Ід-тор'
    );
    Set(
        varNumMainDoc,
        ddl_numMainDoc.Selected.'Номер документа'
    )
);
/*If(
    Value(lb_idMainDoc.Text) = 0,
    If(
        !IsBlank(ddl_businessGroups.Selected.Title) && !IsBlank(ddl_company.Selected.Title) && !IsEmpty(cmb_FullNamePerson.SelectedItems) && !IsBlank(txt_NumDoc.Text) && !IsBlankOrError(DataCardValue21.SelectedDate) && !IsEmpty(DataCardValue28.SelectedItems),
        Set(
            varFillOutRequired,
            true
        ),
        Set(
            varFillOutRequired,
            false
        );
        Notify(
            "Не заповенно всі обов'язкові поля",
            NotificationType.Error
        )
    ),
    If(
        !IsBlank(ddl_businessGroups.Selected.'Ім’я') && !IsBlank(ddl_company.Selected.'Ім’я') && !IsEmpty(cmb_FullNamePerson.SelectedItems) && !IsBlank(txt_NumDoc.Text) && !IsBlank(ddl_numMainDoc.Selected.'Ім’я') && !IsBlankOrError(DataCardValue21.SelectedDate) && !IsEmpty(DataCardValue28.SelectedItems),
        Set(
            varFillOutRequired,
            true
        ),
        Set(
            varFillOutRequired,
            false
        );
        Notify(
            "Заповніть, будь ласка, всі обов'язкові поля",
            NotificationType.Error, 1000
        )
    )
);
If(
    !IsBlankOrError(DataCardValue22.SelectedDate) && !IsBlankOrError(DataCardValue23.SelectedDate),
    If(
        DataCardValue22.SelectedDate < DataCardValue23.SelectedDate,
        Set(
            varFillOutRequired,
            true
        ),
        Set(
            varFillOutRequired,
            false
        );
        Notify(
            "'Термін дії документу по' менший за 'Термін дії документу з'. Прохання виправити значення",
            NotificationType.Error, 1000
        )
    )
);*/

Concurrent(
If(IsBlank(ddl_businessGroups.SelectedText),
    Set(ErrorVisibBussGroup, true);
    Set(ErrorTextBussGroup, "Поле є обов'язковим"),
    Set(ErrorVisibBussGroup, false);
    Set(ErrorTextBussGroup, "")
    
),
If(IsBlank(ddl_company.Selected),
    Set(ErrorVisibComp, true);
    Set(ErrorTextComp, "Поле є обов'язковим"),
    Set(ErrorVisibComp, false);
    Set(ErrorTextComp, "")
),
If(IsBlank(ddl_numMainDoc.Selected),
    Set(ErrorVisibNumMainDoc, true);
    Set(ErrorTextNumMainDoc, "Поле є обов'язковим"),
    Set(ErrorVisibNumMainDoc, false);
    Set(ErrorTextNumMainDoc, "")
),
If(IsBlank(cmb_FullNamePerson.SelectedItems),
    Set(ErrorVisibPIB, true);
    Set(ErrorTextPIB, "Поле є обов'язковим"),
    Set(ErrorVisibPIB, false);
    Set(ErrorTextPIB, "")
),
If(
    IsBlank(txt_NumDoc.Text),
    Set(ErrorVisibility, true);
    Set(ErrorText, "Поле є обов'язковим"),
    Set(ErrorVisibility, false);
    Set(ErrorText, ""),
),
If(IsBlankOrError(DataCardValue21.SelectedDate),
    Set(ErrorVisibDateContract, true);
    Set(ErrorTextDateContract, "Поле є обов'язковим"),
    Set(ErrorVisibDateContract, false);
    Set(ErrorTextDateContract, "")
),
If(IsBlank(DataCardValue28.SelectedItems),
     Set(ErrorVisibSignUser, true);
    Set(ErrorTextSignUser, "Поле є обов'язковим"),
    Set(ErrorVisibSignUser, false);
    Set(ErrorTextSignUser, "")
));
If(
    //varFillOutRequired = true,
    And(ErrorVisibBussGroup = false, ErrorVisibComp = false, Or(ErrorVisibNumMainDoc = false, Value(lb_idMainDoc.Text) = 0), ErrorVisibPIB =false, ErrorVisibility =false, ErrorVisibDateContract = false, ErrorVisibSignUser=false,ErrorVisibFromContractTerm=false,ErrorVisibToContractTerm=false), 
    Set(
        varPatchedItem,
        Patch(
            [@ContractsHR],
            RecordInList,
            {
                'Номер документа': txt_NumDoc.Text,
                Бізнес: ddl_businessGroups.Selected.Title,
                'Юр особа': ddl_company.Selected.Title,
                ПІБ: cmb_FullNamePerson.Selected,
                Посада: DataCardValue19.Text,
                'Тип документу': {Value: lb_TypeDoc.Text},
                'Дата документу': DataCardValue21.SelectedDate,
                'Термін дії документу з': DataCardValue22.SelectedDate,
                'Термін дії документу по': DataCardValue23.SelectedDate,
                'Підписаний роботодавцем': DataCardValue24.Value,
                'Підписаний працівником': DataCardValue25.Value,
                Підписант: DataCardValue28.Selected,
                'Кількість наявних екземплярів': Value(DataCardValue27.Text),
                idMainDocList: varIdMainDoc,
                IdNumMainDoc: varNumMainDoc,
                'Підписант текст': DataCardValue28.Selected.DisplayName
            },
            FormAttachments.Updates
        )
    );
   /* If(
        IsEmpty(Errors('ContractsHR')),
    // on success
        RequestHide();
        'SH-HR-Contracts-PemrItem'.Run(
            nameGroupHr,
            varPatchedItem.'Ід-тор'
        );
        Notify(
            "Success: Запис збрежено",
            NotificationType.Success
        );
        ResetForm(SharePointForm1);
        ResetForm(FormAttachments);
        RequestHide(),
    // on failure
        Notify(
            "Errors: Запис не збережено. ",
            NotificationType.Error
        )
    );*/
    If(
        !IsEmpty(Errors('ContractsHR')),
        // on failure
        Notify(
            "Errors: Запис не збережено. ",
            NotificationType.Error
        ),
        /*Notify(
            "Success: Запис збрежено",
            NotificationType.Success
        );*/
        //RequestHide();
        If(
            SharePointForm1.Mode = FormMode.New,
            'SH-HR-Contracts-PemrItem'.Run(
                nameGroupHr,
                varPatchedItem.'Ід-тор'
            );
            ResetForm(SharePointForm1);
            ResetForm(FormAttachments);
            RequestHide(),
            If(
                And(
                    SharePointForm1.Mode = FormMode.Edit,
                    varChangeBusinessGroup = 2,
                    ddl_businessGroups.Selected.Title <> txt_business.Text
                ),
                Set(
                    varNamePrevGrBusn,
                    LookUp(
                        colSpGroupCompany,
                        'Ім’я' = SharePointIntegration.Selected.Бізнес
                    ).GroupPermission
                );
                'SH-HR-Contracts-EditPemrItem-test'.Run(
                    varNamePrevGrBusn,
                    nameGroupHr,
                    varPatchedItem.'Ід-тор' 
                );
                ResetForm(SharePointForm1);
                ResetForm(FormAttachments);
                RequestHide()
            )
        )
    )
)